<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ filetype|capitalize }} Files - Qail Collective</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="starwars-bg">
  {% include "_header.html" %}

<div class="content">
    <h1 class="title">{{ t["filetypes"].get(filetype, filetype|capitalize ~ " Files") }}</h1>

    {% if files %}
    <!-- Dropdown to select which file to view -->
    <form method="GET" action="{{ url_for('files', filetype=filetype) }}">
        <label for="char-select">{{ t["select_file"] }}:</label>
        <select name="char" id="char-select" onchange="this.form.submit()">
            <option value="">-- {{ t["select_employee"] }} --</option>
            {% for name in files.keys()|sort %}
            <option value="{{ name }}" {% if selected_file and name in selected_file %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
            {% if selected_file and "T. Qail" in selected_file and selected_file["T. Qail"].get("Access Denied") %}
            <option value="T. Qail" selected>T. Qail</option>
            {% endif %}
        </select>
    </form>

    {% if selected_file %}
    {% for name, section in selected_file.items() %}
    <div class="file-entry scifi-container">
      <div class="scifi-container-header">
        <h2>{{ name }}</h2>
      </div>
      <div class="scifi-container-content">
        {% if section.get("Access Denied") %}
        <p class="error">{{ section["Access Denied"] }}</p>
        {% else %}
        <table class="file-table">
            {% for key, value in section.items() %}
            <tr>
                <td class="file-key">{{ t["keys"].get(key, key|capitalize) }}</td>
                <td class="file-value">{{ value }}</td>
            </tr>
            {% endfor %}
        </table>
      </div>
      </div>
        <!-- Editable form for Personnel -->
        {% if filetype == "personnel" and (user in ["T. Qail", "H. Lastal"]) %}
        <h3>{{ t["edit_personnel"] }}</h3>
        <form method="POST" action="{{ url_for('files', filetype=filetype) }}">
            <input type="hidden" name="char" value="{{ name }}">
            {% for key, value in section.items() %}
            <label for="{{ key }}">{{ t["keys"].get(key, key|capitalize) }}</label>
            <input type="text" name="{{ key }}" id="{{ key }}" value="{{ value }}">
            {% endfor %}
            <button type="submit">{{ t["save_changes"] }}</button>
        </form>
        {% endif %}

        <!-- Editable form for Security -->
        {% if filetype == "security" and (user == "T. Qail" or user in ["B.R. Briskat", "E.P. Rinsmitt", "E.T. Jeyik", "J. Latatga", "S. Nito"]) %}
        <h3>{{ t["edit_security"] }}</h3>
        <form method="POST" action="{{ url_for('files', filetype=filetype) }}">
            <input type="hidden" name="char" value="{{ name }}">
            {% for key, value in section.items() %}
            <label for="{{ key }}">{{ t["keys"].get(key, key|capitalize) }}</label>
            <input type="text" name="{{ key }}" id="{{ key }}" value="{{ value }}">
            {% endfor %}
            <button type="submit">{{ t["save_changes"] }}</button>
        </form>
        {% endif %}

        <!-- Editable form for Medical -->
        {% if filetype == "medical" and (user == "T. Qail" or user in ["Q. Dran", "D. Scafcar"]) %}
        <h3>{{ t["edit_medical"] }}</h3>
        <form method="POST" action="{{ url_for('files', filetype=filetype) }}">
            <input type="hidden" name="char" value="{{ name }}">
            {% for key, value in section.items() %}
            <label for="{{ key }}">{{ t["keys"].get(key, key|capitalize) }}</label>
            <input type="text" name="{{ key }}" id="{{ key }}" value="{{ value }}">
            {% endfor %}
            <button type="submit">{{ t["save_changes"] }}</button>
        </form>
        {% endif %}
        {% endif %}
    {% endfor %}
    {% endif %}
    {% else %}
    <p class="error">{{ t["no_files"] }}</p>
    {% endif %}
</div>


</body>
</html>
